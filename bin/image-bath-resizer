#!/usr/bin/env coffee

path        = require 'path'
fs          = require 'fs'

root_path   = path.join (path.dirname fs.realpathSync __filename), '..'

# enable some colors at output
require('colors').setTheme path.join root_path, './etc', '/theme'

Converter   = require path.join root_path, './lib', '/converter'

{ version } = require path.join root_path, 'package.json'
config      = require path.join root_path, './etc', '/config'

# long definition for argv parser
usage_string = 
  """

  Image bath resizer v.#{version}

  Convert image files, recursing walking deeply from selected directory.
  Usage: image-bath-resizer -d [start directory]
  """

argv  = require('optimist')
          .usage(usage_string.help)
          .describe('d', 'Directory to start recursing walking')
          .options('d',
            alias   : ['dir', 'directory']
            demand  : true
          )
          .describe('p', 'Prefix for resized images')
          .options('p',
            alias   : 'prefix'
            demand  : false
            default : config.prefix
          )
          .describe('s', 'Size for image resizing')
          .options('s',
            alias   : 'size'
            demand  : false
            default : config.size
          )          
          .describe('w', 'Workers number(parallel jobs)')
          .options('w',
            alias   : 'workers'
            demand  : false
            default : config.workers
          )       
          .argv

my_converter = new Converter argv, config
my_converter.doConvert()
